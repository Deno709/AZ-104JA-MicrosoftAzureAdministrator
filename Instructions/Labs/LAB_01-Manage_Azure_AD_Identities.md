---
lab:
    title: '01 - Azure Active Directory ID を管理する'
    module: 'モジュール 01 - ID'
---

# 課題 01 - Azure Active Directory ID を管理する

# 受講生用ラボ マニュアル

## ラボ シナリオ

Contoso のユーザーが Azure AD を使用して認証できるようにするには、ユーザーおよびグループ アカウントのプロビジョニングを行う必要があります。グループのメンバーシップは、ユーザーの役職に基づいて自動的に更新されます。テスト ユーザー アカウントを使用してテスト Azure AD テナントを作成し、Contoso Azure サブスクリプションのリソースに対する制限付きアクセス許可をそのアカウントに付与する必要もあります。

## Objectives

このラボでは次の内容を学習しました。

+ タスク 1: Azure AD ユーザーの作成および構成
+ タスク 2: 割り当て済みおよび動的メンバーシップを持つ Azure AD グループを作成します。
+ タスク 3: Azure Active Directory (AD) テナントを作成する
+ タスク 4: Azure AD ゲスト ユーザーを管理します 

## 予想時間: 30 分

## 指示

### 演習 1

#### タスク 1: Azure AD ユーザーの作成および構成

このタスクでは、Azure AD ユーザーを作成および構成します。

1. Azure portal で、「**Azure Active Directory**」 を検索して選択します。

1. 「Azure Active Directory」 ブレードで、**「管理」** セクションまでスクロールダウンし、**「ユーザー設定」** をクリックして、使用可能な構成オプションを確認します。

1. 「Azure Active Directory」 ブレードの **「管理」** セクションで **「ユーザー」** をクリックし、ユーザー アカウントをクリックして**プロファイル**の設定を表示します。 

1. 「**編集**」 をクリックし、「**設定**」 セクションで 「**使用場所**」 を 「**米国**」 に設定し、変更を保存します。

    >**注**: これは、このラボの後半で Azure AD Premium P2 ライセンスをユーザー アカウントに割り当てるために必要です。

1. 「**ユーザー - すべてのユーザー**」 ブレードに戻り、「**+ 新しいユーザー**」 を選択します。

1. 次の設定で、新しいユーザーを作成します (他の設定は既定値のままにします)。

    | 設定 | 値 |
    | --- | --- |
    | ユーザー名 | **az104-01a-aaduser1** |
    | 名前 | **az104-01a-aaduser1** |
    | 自分でパスワードを作成する | 有効 |
    | 初期パスワード | **Pa55w.rd124** |
    | 使用場所 | **米国** |
    | 役職 | **クラウド管理者** |
    | 部署 | **IT** |

    >**注**: **クリップボードに**完全な**ユーザー プリンシパル名** (ユーザー名とドメイン) をコピーします。このタスクの後半で必要になります。

1. ユーザーの一覧で、新しく作成したユーザー アカウントをクリックして、そのブレードを表示します。

1. 「**管理**」 セクションで使用できるオプションを確認し、ユーザー アカウントに割り当てられた Azure AD ロールと、Azure リソースに対するユーザー アカウントのアクセス許可を識別できることを確認します。

1. 「**管理**」 セクションで、「**割り当てられたロール**」 をクリックし、「**+ 割り当ての追加**」 ボタンをクリックして、**ユーザー管理者** ロールを **az104-01a-aaduser1** に割り当てます。

    >**注**: 新しいユーザーをプロビジョニングするときに、Azure AD ロールを割り当てるオプションもあります。

1. 「**InPrivate**」 ブラウザーの画面を開き、新しく作成したユーザー アカウントを使用して [Azure portal](https://portal.azure.com) にログインします。パスワードの更新を求められたら、ユーザー用にパスワードを変更します。

    >**注**: ユーザー名 (ドメイン名を含む) を入力するのではなく、クリップボードの内容を貼り付けることができます。

1. Azure portal の 「**InPrivate**」 ブラウザーの画面で、「**Azure Active Directory**」を検索して選択します。

    >**注**: このユーザー アカウントは Azure Active Directory テナントにアクセスできますが、Azure リソースへのアクセス権はありません。これは予想されたことであり、このようなアクセスは Azure ロールベースのアクセス制御を使用して明示的に付与する必要があるためです。 

1. 「**InPrivate**」 ブラウザーの画面の 「Azure AD」 ブレードで、「**管理**」 セクションまでスクロールダウンし、「**ユーザー設定**」 をクリックします。また、構成オプションを変更する権限がないことに注意してください。

1. 「**InPrivate**」 ブラウザー画面の 「Azure AD」 ブレードの、「**「管理」**」 セクションで、「**ユーザー**」 をクリックし、「**+ 新しいユーザー**」 をクリックします。

1. 次の設定で、新しいユーザーを作成します (他の設定は既定値のままにします)。

    | 設定 | 値 |
    | --- | --- |
    | ユーザー名 | **az104-01a-aaduser2** |
    | 名前 | **az104-01a-aaduser2** |
    | 自分でパスワードを作成する | 有効 |
    | 初期パスワード | **Pa55w.rd124** |
    | 使用場所 | **米国** |
    | 役職 | **システム管理者** |
    | 部署 | **IT** |

1. Azure portal から az104-aaduser1 ユーザーとしてサイン アウトし、「InPrivate」 ブラウザーの画面を閉じます。

#### タスク 2: 割り当て済みおよび動的メンバーシップを持つ Azure AD グループを作成します。

このタスクでは、割り当てられた動的メンバーシップを持つ Azure Active Directory グループを作成します。

1. ユーザー アカウントでサインインしている Azure portal に戻り、Azure AD テナントの **「概要」** ブレードに戻り、**「管理」** セクションの **「ライセンス」** をクリック します。

    >**注**: 動的グループを実装するには、Azure AD Premium P1 または P2 ライセンスが必要です。

1. 「**管理**」 セクションで、「**すべての製品**」 をクリックします。

1. 「**+ 試用/購入**」 をクリックし、Azure AD Premium P2 の無料試用版をアクティブ化します。

1. ブラウザーの画面を更新して、アクティブ化が成功したことを確認します。 

1. **「ライセンス - すべての製品」** ブレードで、**Azure Active Directory Premium P2** エントリを選択し、Azure AD Premium P2 のすべてのライセンス オプションをユーザー アカウントと新しく作成した 2 つのユーザー アカウントに割り当てます。

1. Azure portal で、「Azure AD」 ブレードに戻り、**「グループ」** をクリックします。

1. **「+ 新しいグループ」** を使用して、次の設定で新しいグループを作成します。

    | 設定 | 値 |
    | --- | --- |
    | グループ タイプ | **セキュリティ** |
    | グループ名 | **IT クラウド管理者** |
    | グループの説明 | **Contoso IT クラウド管理者** |
    | メンバーシップ タイプ | **動的ユーザー** |

    >**注**: **「メンバーシップの種類」**ドロップダウン リストがグレー表示されている場合は、数分待ってからブラウザーのページを更新します。

1. **「動的クエリの追加」** をクリックします。

1. **「動的メンバーシップ ルール」** ブレードの **「ルールの構成」** タブで、次の設定を使用して新しいルールを作成します。

    | 設定 | 値 |
    | --- | --- |
    | プロパティ | **jobTitle** |
    | 演算子 | **等しい** |
    | 値 | **クラウド管理者** |

1. **「新しいグループ」** ブレードに戻り、**「作成」** をクリックします。 

1. Azure AD テナントの 「**グループ - すべてのグループ**」 ブレードに戻り、「**+ 新しいグループ**」 ボタンをクリックし、次の設定で新しいグループを作成します。

    | 設定 | 値 |
    | --- | --- |
    | グループ タイプ | **セキュリティ** |
    | グループ名 | **IT システム管理者** |
    | グループの説明 | **Contoso IT システム管理者** |
    | メンバーシップ タイプ | **動的ユーザー** |

1. **「動的クエリの追加」** をクリックします。

1. **「動的メンバーシップ ルール」** ブレードの **「ルールの構成」** タブで、次の設定を使用して新しいルールを作成します。

    | 設定 | 値 |
    | --- | --- |
    | プロパティ | **jobTitle** |
    | 演算子 | **等しい** |
    | 値 | **システム管理者** |

1. **「新しいグループ」** ブレードに戻り、**「作成」** をクリックします。 

1. Azure AD テナントの **「グループ - すべてのグループ」** ブレードに戻り、**「+ 新しいグループ」** ボタンをクリックし、次の設定で新しいグループを作成します。

    | 設定 | 値 |
    | --- | --- |
    | グループ タイプ | **セキュリティ** |
    | グループ名 | **IT ラボ管理者** |
    | グループの説明 | **Contoso IT ラボ管理者** |
    | メンバーシップ タイプ | **割り当て済み** |

1. **「メンバーが選択されていません」** をクリックします。

1. **「メンバーの追加」** ブレードで、**IT クラウド管理者** グループと **IT システム管理者** グループを検索して選択 し、**「新しいグループ」** ブレードで **「作成」** をクリックします。

1. **「グループ - すべてのグループ」** ブレードに戻り、**IT クラウド管理者**グループを表すエントリをクリックし、**「メンバー」** ブレードを表示します。グループ メンバーのリストに **az104-01a-aaduser1** が表示されることを確認します。

1. **「グループ - すべてのグループ」** ブレードに戻り、**IT システム管理者**グループを表すエントリをクリックし、**「メンバー」** ブレードを表示します。グループ メンバーのリストに **az104-01a-aaduser2** が表示されることを確認します。

    >**注**: 動的メンバーシップ グループの更新に遅延が発生する可能性があります。更新を迅速化するには、グループ ブレードに移動し、**「動的メンバーシップ ルール」** ブレードを表示し、**「ルール構文」** テキストボックスに一覧表示されている ルールを**編集**して末尾に空白を追加し、変更を**保存**します。

#### タスク 3: Azure Active Directory (AD) テナントを作成する

このタスクでは、新しい Azure AD テナントを作成します。

1. Azure portal で、「**Azure Active Directory**」 を検索して選択します。

1. 「**+ テナントを作成**」 をクリックし、次の設定を指定します。

    | 設定 | 値 |
    | --- | --- |
    | ディレクトリ タイプ | **Azure Active Directory** |
    | 組織名 | **Contoso ラボ** |
    | 初期ドメイン名 | 小文字と数字で構成され、文字で始まる有効な DNS 名 | 
    | 国/地域 | **米国** |

   > **注**: **初期ドメイン名**テキスト ボックスの緑色のチェック マークは、入力したドメイン名が有効で一意であることを示します。

1. 「**Review + create**」 をクリックし、「**作成**」 をクリックします。

1. 新しく作成した Azure AD テナントのブレードを表示するには、ここを**クリックして新しいディレクトリに移動します。Contoso Lab** リンクもしくは Azure portal ツールバーにある 「**Directory + Subscription**」 ボタン (「クラウド シェル」 ボタンの右側) をクリックします。

#### タスク 4: Azure AD ゲストユーザーを管理します。

このタスクでは、Azure AD ゲスト ユーザーを作成し、Azure サブスクリプション内のリソースへのアクセスを許可します。

1. Contoso Lab Azure AD テナントを表示する Azure portal の 「**管理**」 セクションで、「**ユーザー**」 をクリックし、「**+ 新しいユーザー**」 をクリックします。

1. 次の設定で、新しいユーザーを作成します (他の設定は既定値のままにします)。

    | 設定 | 値 |
    | --- | --- |
    | ユーザー名 | **az104-01b-aaduser1** |
    | 名前 | **az104-01b-aaduser1** |
    | 自分でパスワードを作成する | 有効 |
    | 初期パスワード | **Pa55w.rd124** |
    | 役職 | **システム管理者** |
    | 部署 | **IT** |

    >**注**: **クリップボードに**完全な**ユーザー プリンシパル名** (ユーザー名とドメイン) をコピーします。このタスクの後半で必要になります。

1. Azure portal のツールバーにある 「**Directory + Subscription**」 ボタン (「Cloud Shell」 ボタンの右側) を使用して、既定の Azure AD テナントに切り替えます。

1. 「**ユーザー - すべてのユーザー**」 ブレードに戻り、「**+ 新しいゲスト ユーザー**」 を選択します。

1. 次の設定で新しいゲスト ユーザーを作成します (他の設定は既定値のままにします)。

    | 設定 | 値 |
    | --- | --- |
    | 名前 | **az104-01b-aaduser1** |
    | メール アドレス | このタスク前半でクリップボードにコピーした値を貼り付けます |
    | 使用場所 | **米国** |
    | 役職 | **ラボ管理者** |
    | 部署 | **IT** |

1. 「**招待**」 をクリックします。 

1. 「**ユーザー - すべてのユーザー**」 ブレードに戻り、新しく作成されたゲスト ユーザー アカウントを表すエントリをクリックします。

1. **「az104-01b-aaduser1 - プロファイル」** ブ」レードで、**「グループ」** をクリックします。

1. **「+ メンバーシップの追加」** をクリックし、ゲスト ユーザー アカウントを **IT ラボ管理者**グループに追加します。


#### リソースをクリーンアップします。

   >**注**: 新規作成した Azure リソースのうち、使用しないリソースは必ず削除してください。使用していないリソースを削除することで、予期しないコストが発生しなくなります。この場合、Azure Active Directory テナントとそのオブジェクトに関連する追加料金は発生しませんが、このラボで作成したユーザー アカウント、グループ アカウント、および Azure Active Directory テナントの削除を検討する必要があります。

1. **「Azure Active Directory Premium P2 - ライセンス ユーザー」** ブレードに移動し、このラボでライセンスを割り当てたユーザー アカウントを選択します。**「ライセンスの削除」** をクリックし、確認を求められたら、**「OK」** をクリックします。

1. Azure portal で、**ユーザー - すべてのユーザー** ブレードに移動し、**az104-01b-aaduser1** ゲスト ユーザー アカウントを表すエントリをクリックします。**「az104-01b-aaduser1 - Profile」** ブレードで **「削除」** をクリックし、確認を求められたら、**「OK」** をクリックします。

1. 同じ手順を繰り返して、このラボで作成した残りのユーザー アカウントを削除します。

1. 「**グループ - すべてのグループ**」 ブレードに移動し、このラボで作成したグループを選択し、「**削除**」 をクリックします。確認を求められたら、「**OK**」 をクリックします。

1. Azure portal で、Azure portal のツール バーの 「**Directory + Subscription**」 ボタン (「Cloud Shell」 ボタンの右側) を使用して、Contoso Lab Azure AD テナントのブレードを表示します。

1. 「**ユーザー - すべてのユーザー**」 ブレードに移動し、**az104-01b-aaduser1** ユーザー アカウントを表すエントリをクリックします。「**az104-01b-aaduser1 - Profile**」 ブレードで 「**削除**」 をクリックし、確認を求められたら、「**OK**」 をクリックします。

1. Contoso Lab Azure AD テナントの 「**Contoso Lab - 概要**」 ブレードに移動し、「**テナントを削除**」 を選択し、「**ディレクトリ 'Contoso Lab' を削除する**」 ブレードで、「**Azure リソースを削除する権限を取得する**」リンクを選択し、Azure Active Directory の 「**プロパティ**」 ブレードで、「**Azure リソースのアクセス管理**」 を 「**はい**」 に設定し、「**保存**」 を選択します。

1. Azure portal からサインアウトし、再度サインインします。 

1. 「**ディレクトリ 'Contoso Lab' の削除**」 ブレードに戻り、「**削除**」 をクリックします。

#### レビュー

このラボでは次の内容を学習しました。

- Azure AD ユーザーを作成および設定しました
- 割り当て済みおよび動的メンバーシップを持つ Azure AD グループを作成します
- Azure Active Directory (AD) テナントを作成しました
- Azure AD ゲスト ユーザーの管理 
